 migrate-vm: migrate VMs between hosts – Open Computing Facility Toggle navigation Open Computing Facility Join About Us Our Organization Joining the Staff Team Lab Statistics Backend Infrastructure Services Computer Lab Printing Web Hosting Application Hosting SSH/SFTP (Shell) Email Hosting MySQL Database Software Mirrors High Performance Computing Staff Hours Help Contact Us Log In migrate-vm: migrate VMs between hosts Table of Contents Usage Steps performed Final steps Assumptions Made Usage This script is used for migrating KVM virtual machines between physical hosts. The script should be run on the new host for the virtual machine using the following format. The first hostname specified in the command is what physical host to move the virtual machine from, and the second one is the name of the virtual machine to move. For example, the following command moves supernova from jaws to whatever KVM host the command is run on: sudo migrate-vm jaws:supernova Steps performed To move the virtual machine, migrate-vm performs the following steps: Shuts down the virtual machine on the old host. Creates a new LVM volume on the new host with the correct size. Securely copies the virtual machine's disk from the old host to the new host. Checksums both the old and the new disks on each machine to ensure they match. Imports the KVM domain definition from the old host to the new host. Final steps After the virtual machine has been transferred between hosts, make sure the guest works on the new host. If moving from hal , you might need to delete the custom CPU definition section from the KVM XML to get the virtual machine to start. To edit the XML definition, run sudo virsh edit ${hostname} . The section to delete looks like this: <cpu mode= 'custom' match= 'exact' > <model fallback= 'allow' > Opteron_G3 </model> </cpu> Then, after everything works, you should remove the old KVM and LVM definitions on only the old host: sudo virsh undefine ${hostname} sudo lvremove /dev/vg/${hostname} Assumptions Made The LVM volume group /dev/vg is used on both the old and new host. Virtual machines are stored at /dev/vg/${hostname} on both hosts. Edit this Page Page History Table of Contents Usage Steps performed Final steps Assumptions Made More in this category Scripts approve: record an OCF group account request check: get details about an OCF user checkacct: find accounts by full name chpass: reset a user's password economode: turn economode on/off on the printers how: view the source of a script lab-wakeup: wake up suspended desktops migrate-vm: migrate VMs between hosts note: add notes to a user account ocf-tv: connect to the tv or modify the volume paper: view and modify print quotas pdf-open: unf*&^ bad PDFs if they won't print right signat: check signatory status sorry: disable an OCF account ssh-list: run command via SSH on many hosts simultaneously unsorry: re-enable a sorried account OCF ♥ Linux , Kubernetes , Python , Nix , and Free/Open-Source Software. Sound like you? Join the staff team! About the OCF Overview Officers Official Documents Board Meeting Minutes Privacy Policy Account Tools Join the OCF Reset Password Manage My Account Services Computer Lab & Printing Web Hosting Application Hosting Email Hosting SSH/Remote Shell High Performance Computing Help and Support Status Blog Donate to the OCF Frequently Asked Questions User Documentation Staff Documentation Contact Us The Open Computing Facility is run entirely by student volunteers. Copyright © 1989–2025 Board of Directors of the Open Computing Facility. The Open Computing Facility is a Chartered Program of the ASUC. 